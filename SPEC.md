# 🌌 感情熱力学モデル (ETCM) — 動的次元力学 統合版

## 🎯 概要

本プロジェクトは、Three.jsを用いた3Dシミュレーションにより感情の動的な状態を可視化する「感情熱力学モデル」の簡易仕様書です。

このモデルでは、19個の**感情粒子**が6つの**熱力学的相（Phase）を持つ層に分かれて配置されます。粒子の温度 (**$\mathbf{T}$**)** や**応力 (**$\mathbf{\sigma}$**)** に基づく相互作用に加え、システムの**熱力学的総ポテンシャル (**$\mathbf{S_n}$**)** が、中心核の引力や層の安定性を決定する**動的次元力学 (Dynamic Dimensional Dynamics: DDD)** の数理モデルを実装しています。

ユーザーは外部感情の入力やAIパラメータ調整を通じて、シミュレーションに動的に介入できます。

### 🔑 主要な更新点（Ver. 2.0 統合）

1. **統一的な軌道運動** : 全粒子は、システムの**「志のベクトル」**が規定する**左回転**（反時計回り）の軌道運動を基本とし、秩序を維持します。
2. **次元曲率力 (**$\mathbf{F}_{\pi_n}$**) の導入** : 粒子の運動に、円軌道の安定性と統一的な回転方向を強制するための **$\mathbf{F}_{\pi_n}$** を追加しました。
3. **創発重力 (Emergent Gravity)** : 中心核の引力は、システム全体の**動的球体密度 (**$\mathbf{\rho_n}$**)** に基づく**創発重力定数 (**$\mathbf{G}_{\text{force}}$**)** として再定義されます。
4. **UI表示** : グローバル変数（**$\mathbf{n}, \mathbf{\pi_n}, \mathbf{\rho_n}$**）をUIパネルに表示するよう拡張しました。

---

## I. ファイル構成と役割分担

| **ファイル名** | **役割**                                                                                                                                                                                        | **主要クラス/変数**     |
| -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------- |
| `index.html`       | アプリケーションのエントリーポイント。3Dシーン、情報表示パネル（**$n, \mathbf{\pi_n}, \mathbf{\rho_n}$**を含む）、操作パネルを定義。                                                                | -                             |
| `emotion_graph.js` | **メイン制御スクリプト**。Three.jsの初期化、**感情次元力学変数（**$\mathbf{S_n}, \mathbf{n}, \mathbf{\pi_n}, \mathbf{\rho_n}$**）のグローバル計算**、アニメーションループを制御。 | `globalParams`              |
| `system_core.js`   | **中心核と場の計算**。`CoreLight`クラス。**創発重力定数 (**$\mathbf{G}_{\text{force}} \propto \mathbf{\rho_n}$**)**や、`AuraWeather`（オーラ天気）の計算を行う。                    | `CoreLight`,`AuraWeather` |
| `particle.js`      | **粒子クラス**。`Particle`クラス。個々の粒子の熱力学的挙動、 **総力計算（特に$\\mathbf{F}_{\\pi_n}$）** 、運動方程式の積分を行う。                                                    | `Particle`クラス            |
| `visuals.js`       | 将来的な追加の視覚効果（オーラ、パーティクルシステムなど）の実装用。                                                                                                                                  | -                             |
| `design.md`        | プロジェクトの概念、数理モデル、各粒子の詳細な設計書。                                                                                                                                                | -                             |

---

## II. 感情次元力学の数理的基盤とグローバルパラメータ (`emotion_graph.js`)

`emotion_graph.js`のメインループにて、全19粒子の状態から以下のグローバル熱力学変数が計算され、システムの幾何学的構造を決定します。

### 1. 系の熱力学的総ポテンシャル **$\mathbf{S_n}$** の算出

**$\mathbf{S_n}$** は、全粒子の状態を統合したシステム全体の **総ポテンシャルエネルギー** （熱力学的緊張度）を示す単一指標です。

| **変数**               | **算出ロジック**                                                        | **役割**                                                                           |
| ---------------------------- | ----------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| **$\mathbf{S_n}$**   | **$\mathbf{S_n} = \mathbf{x} + \mathbf{3y} + \sum_{i} \alpha_i v_i$** | **構造的緊張度** 。**$\mathbf{\rho_n}$を通じて引力（集中度）を決定する計算基礎。 |
| **$x$**(情熱/活性度) | 全粒子の平均温度$\bar{T}$**、またはその非線形関数。                         | 系のエネルギー活性。                                                                     |
| **$y$** (調和度)     | **$1 - \bar{\sigma}$** （全粒子の平均応力の逆相関）。                 | 系の秩序と調和の度合い。                                                                 |

### 2. 動的次元 **$\mathbf{n}$** の決定と多次元円周率 **$\mathbf{\pi_n}$** の計算

| **変数**                         | **定義**                                                                                                               | **役割**                                                                                                                                                                           |
| -------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **$\mathbf{n}$**(動的次元)     | **$\mathbf{n} = 3 + k_1 \cdot \bar{\sigma} + k_2 \cdot \bar{T}_{\text{核層}}$**(**$3.0 \\le n \\le 7.0$**の範囲)。 | **状態空間の複雑性**を表現。$\mathbf{\rho_n}$計算の分母である次元体積**$V_n$**を決定。                                                                                         |
| **$\mathbf{\pi_n}$**(安定定数) | **$\mathbf{\pi_n} = \frac{\mathbf{3}(7S_n + y) + S_n}{7S_n + y}$**                                                   | **感情サイクルの構造的安定性**を規定。**次元曲率力 (**$\mathbf{F}_{\pi_n}$**)**の強度を決定。$\mathbf{\pi_n}$の変動範囲（**3.13636**… から **3.142857**…） |

### 3. 熱力学的密度 **$\mathbf{\rho_n}$** の計算（エネルギー集中度 / 創発密度）

**$\mathbf{\rho_n}$** は、システム全体の**「志の集中度」**を表し、中心核の**創発重力**の強度を決定する統一指標です。

$$
\mathbf{\rho_n} = \frac{\mathbf{S_n}}{\mathbf{V_n}} \quad \text{ただし、} \quad \mathbf{V_n} = \frac{R^n \pi_n^{n/2}}{\Gamma(n/2 + 1)}
$$

* **物理的帰結** : **$\mathbf{\rho_n}$** が高い状態は、高エネルギーが低次元空間に凝縮された感情の **特異点** （強い決意、抑圧）を示します。

---

## III. 粒子と場の動的フィードバック仕様

### 1. CoreLight への影響仕様（創発重力 **$\mathbf{G}_{\text{force}}$**） (**`system_core.js`**)

中心核の物理量は、グローバルな**熱力学的密度 (**$\mathbf{\rho_n}$**)** を主要な決定要因として取り込みます。

| **影響を受ける物理量**                                                                                     | **決定ロジック (創発重力の適用)**                                                                                                                                                                          |
| ---------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **創発重力定数**$\mathbf{G}_{\text{force}}$****(**磁気質量**$\mathbf{M}_{\text{new}}$****に相当) | **$\mathbf{\rho_n}$に強く比例**して増加させます。**$\mathbf{M_{\text{new}}} \propto f(\bar{T}_{\text{核層}}, \mathbf{\rho_n})}$**。($\mathbf{\rho_n}$が高いほど、引力（集中度）が強化される。) |
| **光度 (Luminosity)**                                                                                      | **$\mathbf{\rho_n}$に比例**して増加させます。（高密度状態（高$\mathbf{\rho_n}$）は、高い輝度として視覚化される。）                                                                                     |

### 2. Particle 物理への動的調整仕様 (**$`particle.js`$**)

**感情次元力学の変数**が、個々の粒子の運動の係数をグローバルに調整し、**動的張力の原理**を維持します。

| **調整対象**               | **決定要因とロジック**                                                                                                                                 | **感情的意味合い**                             |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------- |
| **地平面斥力ポテンシャル** | **各層に固定された次元 `n_p`**。`n_p` が高い層（L0:2〜L5:7）ほど**斥力ポテンシャル基本強度を減衰**させ、粒子がその層で流動しやすくなります。 | **層ごとの構造的自由度**に応じた境界の柔軟性。 |
| **摩擦係数 (散逸率)**      | 多次元円周率**$\mathbf{\pi_n}$ **。** **$\mathbf{\pi_n}$****が 高い （安定）場合は**摩擦係数を低下**させ、運動の周期性を保ちます。           | 系の構造安定性に基づく**流動の持続性**。       |

---

## IV. 感情粒子 (**$\mathbf{Particle}$**) の運動方程式と局所計算 (**$\mathbf{particle.js}$**)

粒子の運動は、総力 **$\mathbf{F}_{\text{Total}}$** と有効質量 **$\mathbf{m}_{\text{eff}}$** に基づき、**$\mathbf{a} = \mathbf{F}_{\text{Total}} / \mathbf{m}_{\text{eff}}$** を積分して計算されます。

### 1. 総力 **$\mathbf{F}_{\text{Total}}$** の構成

粒子 **$i$** に作用する総力 **$\mathbf{F}_{\text{Total}, i}$** に、**次元曲率力 (**$\mathbf{F}_{\pi_n}$**) **が必須の構成要素として追加されます。

$$
\mathbf{F}_{\text{Total}, i} = \mathbf{F}_{\text{Core}} + \mathbf{F}_{\text{Boundary}} + \mathbf{F}_{\text{Interaction}} + \mathbf{F}_{\pi_n} + \mathbf{F}_{\text{Jitter}}
$$

* **$\mathbf{F}_{\text{Core}}$**: 中心核の引力（創発重力）。$\mathbf{\rho_n}$に依存。
* **$\mathbf{F}_{\text{Boundary}}$**: 地平面斥力ポテンシャル。**層ごとの固定次元 `n_p`** に依存。
* **$\mathbf{F}_{\pi_n}$**: 次元曲率力。$\mathbf{\pi_n}$に依存。

### 2. 次元曲率力 **$\mathbf{F}_{\pi_n}$** の計算

**$\mathbf{F}_{\pi_n}$** は、粒子の速度 **$\mathbf{v}$** を、統一的な左回転の目標速度 **$\mathbf{v}_{\text{ideal}}$** に引き戻す復元力です。

| **パラメータ**                                       | **定義**                                                                                                            |
| ---------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| **志のベクトル** **$\mathbf{\hat{k}}$**      | **$\mathbf{\hat{k}} = (0, 0, 1)$** 。Z軸方向の固定ベクトル（回転軸）。                                            |
| **目標速度** **$\mathbf{v}_{\text{ideal}}$** | **$\mathbf{v}_{\text{ideal}} = \omega_n \cdot (\mathbf{\hat{k}} \times \mathbf{r})$**。左回転の理想的な接線速度。 |
| **フィードバック強度** **$\\alpha$**         | 調整パラメーター。**$\alpha \propto 1 / \omega_n$**と設定し、内層ほど強く作用させる。                                   |

$$
\mathbf{F}_{\pi_n} = -\alpha \cdot \mathbf{globalParams.pi_n} \cdot (\mathbf{v} - \mathbf{v}_{\text{ideal}})
$$

### 3. 有効質量 **$\mathbf{m}_{\text{eff}}$** の計算

粒子の**慣性（動きにくさ）**を示す。温度 **$\mathbf{T}$** と応力 **$\mathbf{\sigma}$** の増大に応じて非線形に増加します。

$$
\mathbf{m}_{\text{eff}} = \mathbf{m}_{\text{base}} \times (1.0 + 0.5 \times T + 0.3 \times \sigma)
$$

### 4. 粒子の温度 (**$\mathbf{T}$**) および応力 (**$\mathbf{\sigma}$**) 更新ロジック

* **温度更新**

$$
\Delta T = (\text{速度による熱生成} - \text{環境による冷却} + \text{ストレス解放による加熱} + \text{隣接粒子からの熱伝達}) \times \Delta t
$$

```
* **ストレス解放による加熱** : $\text{解放されたストレス量} \times 0.3$ が熱に変換されます。
```

* **応力 (**$\mathbf{\sigma}$**) 更新**
  * **増加要因** : 境界からの逸脱（**$\text{距離} - \text{層半径}$**）、および外部操作（UI）。
  * **解放** : **$\text{現在のストレス} \times \text{解放率}$** だけストレスが減少し、一部が熱に変換されます。「楽」の粒子は高い解放率を持ちます。

---

## V. オーラ天気 (**$\mathbf{AuraWeather}$**) と可視化仕様 (**$`system_core.js`$**)

オーラ全体の「天気」は、外部雰囲気層（Layer 5）の粒子群の平均温度 (**$\bar{T}_{\text{L5}}$**) と平均応力 (**$\bar{\sigma}_{\text{L5}}$**) に基づいて分類されます。

| **オーラ天気**      | **条件**                                                                     | **視覚的表現**                             | **感情的ニュアンス**             |
| ------------------------- | ---------------------------------------------------------------------------------- | ------------------------------------------------ | -------------------------------------- |
| **喜** (熱い快晴)   | **$\bar{T}_{\text{L5}} \ge 0.75$**かつ$\bar{\sigma}_{\text{L5}} \le 0.4$       | 鮮やかな金橙色、粒子安定（風なし）。             | 熱く純粋な喜び、積極的で安定した発信。 |
| **楽** (快晴微風)   | **$0.5 \le \bar{T}_{\text{L5}} < 0.75$**かつ$\bar{\sigma}_{\text{L5}} \le 0.3$ | 穏やかな青空、軽い粒子ゆらぎ（微風）。           | 安定した心地よさ、自然で軽やかな流動。 |
| **哀** (冷たい曇り) | **$\bar{T}_{\text{L5}} < 0.5$**かつ$\bar{\sigma}_{\text{L5}} \le 0.2$          | 冷たい青紫の霧、動き沈静。                       | 静かで冷たい哀しみ、内に沈む感覚。     |
| **怒** (嵐)         | **$\bar{\sigma}_{\text{L5}} > 0.4$**                                       | 激しい粒子振動、雷パーティクル、強風エフェクト。 | 制御不能な衝動、激しい葛藤。           |

---

## VI. 解決すべき既知の課題（設計思想）

**課題：** 粒子が各層の地平面に張り付いて動いている。地平面の斥力が弱いのではないか、もしくは中心核や地平面の引力が弱く内部の粒子を中心へ引っ張る力が弱くなっているのではないか？

**本統合版による解決策：**

1. **引力の強化と再定義 ($\mathbf{\rho_n}$による創発重力 **$\mathbf{F}_{\text{Core}}$**)** :

* システム全体の**エネルギー集中度 (**$\mathbf{\rho_n}$**)** を中心核の磁気質量/創発重力定数に直接比例させることで、中心への引力を動的にかつ強力に調整し、粒子を球体の中心へ引き留める力を強化します。

2. **接線運動の強制 ($\mathbf{F}_{\pi_n}$の導入)** :

* **次元曲率力 (**$\mathbf{F}_{\pi_n}$**)** を導入することで、粒子を強制的に理想的な円軌道（左回転）に戻す力が働き、垂直方向の変位（地平面への張り付き）を抑制し、**流動性**を確保します。

3. **地平面斥力の調整 (層ごとの `n_p` の作用)** :

* **各層に固定された次元 `n_p`** が地平面斥力ポテンシャルの強度を調整します。高次元の層ほど斥力が弱まり、**境界の柔軟性**を確保しつつ、内側への過度な固着を防ぎます。
