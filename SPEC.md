# 感情熱力学モデル (ETCM) — 動的次元力学（DDD）統合版  
**公式簡易仕様書 SPEC.md （継続開発中）** 
**最終更新：2025年12月1日**

これは **HTML + Three.js で実装する感情球体 3D 可視化システム** の現時点での最良仕様書です。  
理論・数理・視覚が完全に一致しつつ、今後も自由に進化させられるよう設計されています。

### 1. システム概要（固定部分）

| 項目                | 値                              |
|---------------------|---------------------------------|
| 総粒子数            | 19（中心核1 ＋ 18感情粒子）     |
| 層構成              | 6層＋中心核                     |
| 静的次元割り当て    | L0=2D, L1=3D, …, L5=7D         |
| フレームレート      | requestAnimationFrame（実質60fps） |
| 唯一のマスター制御変数 | **Γₙ = ln(1 + ρₙ)**（全物理・視覚の中核） |

### 2. ファイル責任範囲（現行確定）

| ファイル名           | 必須実装内容                                                                 |
|----------------------|--------------------------------------------------------------------------------|
| `index.html`         | UIパネルにリアルタイム表示：πₙ（平均）・ρₙ・Γₙ・季節・オーラ天気・支配的感情名 |
| `emotion_graph.js`   | メインループ。毎フレーム `updateGlobalDDD()` → globalParams更新 → UI反映     |
| `system_core.js`     | 全6層の πₙ・Vₙ・ρₙ・Γₙ を下表数式で計算＋季節判定＋オーラ天気＋CoreLight更新 |
| `particle.js`        | 層別Fₚᵢₙ・創発重力∝Γₙ・量子ゆらぎ∝1/Γₙ・速度上限∝√T を必ず実装           |
| `visuals.js`         | （任意）季節別色相・オーラエフェクト                                           |

### 3. 層別動的次元力学 数式表（system_core.js でこの通りに計算）

| 層               | n | Sₙ                     | πₙ（確定式）                              | 実装用展開形（b=全層共通）                                 | Vₙ（半径=1）                         | ρₙ         |
|------------------|---|------------------------|-------------------------------------------|------------------------------------------------------------|---------------------------------------|------------|
| L0 核層          | 2 | a + 3b                 | (22S₂ + 3b)/(7S₂ + b)                     | (22a + 69b)/(7a + 22b)                                      | π₂                                    | π₂ / 4     |
| L1 身体層        | 3 | S₂ + 3c                | (22S₃ + 3b)/(7S₃ + b)                     | (22a + 69b + 66c)/(7a + 22b + 21c)                          | π₃^(3/2)/(1.5√π)                      | V₃ / 9     |
| L2 思考層        | 4 | S₃ + 3d                | (22S₄ + 3b)/(7S₄ + b)                     | … + 66d / … + 21d                                          | π₄² / 2                               | V₄ / 16    |
| L3 文明層        | 5 | S₄ + 3e                | (22S₅ + 3b)/(7S₅ + b)                     | … + 66e / … + 21e                                          | π₅^(5/2)/(3.75√π)                     | V₅ / 25    |
| L4 外部接合層    | 6 | S₅ + 3f                | (22S₆ + 3b)/(7S₆ + b)                     | … + 66f / … + 21f                                          | π₆³ / 6                               | V₆ / 36    |
| L5 外部雰囲気層  | 7 | S₆ + 3g                | (22S₇ + 3b)/(7S₇ + b)                     | … + 66g / … + 21g                                          | π₇^(7/2)/(52.5√π/4)                   | V₇ / 49    |

### 4. globalParams 現行構造（自由に拡張可）

```js
globalParams = {
  pi_n_by_layer:    [],   // [π₂, π₃, π₄, π₅, π₆, π₇] ← 必須
  rho_n_by_layer:   [],
  Gamma_n_by_layer: [],   // ln(1 + rho_n) ← 実質的なマスター変数

  pi_n_average: 3.14159,  // UI用
  season: "冬",
  auraWeather: "喜",
  dominantEmotion: "強固な調の喜び（熱い快晴・夏）"
};
```

### 5. 次元曲率力 Fₚᵢₙ — 層別独立（particle.js 推奨実装）

```js
const layerIdx = this.layer;  // 0=L0 ～ 5=L5
const π_local = globalParams.pi_n_by_layer[layerIdx];

const axis = new THREE.Vector3(0,0,1);
const omega_n = 2.8 * Math.exp(-0.65 * layerIdx);
const v_ideal = new THREE.Vector3().crossVectors(axis, this.position).normalize()
                  .multiplyScalar(omega_n * this.position.length());

const alpha = 1.3 / (1 + 0.7 * layerIdx);

const F_pi_n = v_ideal.clone().sub(this.velocity)
                .multiplyScalar(-alpha * π_local);

this.force.add(F_pi_n);
```

### 6. その他必須物理（調整自由）

```js
// 創発重力
const G_eff = 0.20 * globalParams.Gamma_n_by_layer[this.layer];

// 量子ゆらぎ
const jitter = 0.055 / globalParams.Gamma_n_by_layer[this.layer];

// 速度上限
this.velocity.clampLength(0, 1.35 * Math.sqrt(this.temperature + 0.05));
```

### 7. 今後の拡張予定

- 外部入力（テキスト感情分析）で直接操作
- 粒子間の情報伝達項（エントロピー流）追加
- 支配的感情名の76+種をデータテーブル化

**この仕様書は「現時点での最良の完成形」であり、同時に「次の進化の土台」です。**  
いつでも安全に改良・実験・拡張できます。

**継続開発を歓迎します。**  
次のステップをいつでもどうぞ。

### 8. 実装完了チェックリスト（すべてチェックで理論100%再現）

- [ ] 表3の数式で全6層の πₙ・ρₙ・Γₙ を計算  
- [ ] 層別 πₙ を Fₚᵢₙ に使用（平均値は廃止）  
- [ ] 創発重力 ∝ Γₙ  
- [ ] 量子ゆらぎ ∝ 1/Γₙ  
- [ ] 季節・オーラ天気・支配的感情名がリアルタイム表示  

**この仕様書を最後に、ETCMは完全閉じた自己組織化ループとして成立する。**  
