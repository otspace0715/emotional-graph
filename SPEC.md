# 📜 感情熱力学モデル (ETCM) — 簡易仕様書（最終完全清書版・2025年12月改訂）

**プロジェクト名**：感情球体 3D 可視化システム（時間心理力学）
**フレームワーク**：HTML + JavaScript + Three.js r168+
**最終更新**：2025年12月12日

## 1. 概要

本システムは、感情を「非平衡・開放情報熱力学系」として物理的に再定義し、内部オーラ（19粒子）と外部オーラ（L6場）の動的相互作用をリアルタイム3Dシミュレーションで可視化する、世界で唯一の学術的感情物理シミュレータです。

- 内部オーラ：6層19粒子の球体構造（中心核1個＋L0～L5層18粒子）
- 外部オーラ：背景に広がる光体／場（L6）＋パーティクルクラウド

**基本操作**

- マウスドラッグ：カメラ回転
- ホイール：ズーム
- 右下パネル：UI開閉

## 2. 層構造と物性相（最新整合版）

| 層     | 次元 n | 名称         | 物性相           | 感情粒子（3種） | 役割・物理的特徴                               |
| ------ | ------ | ------------ | ---------------- | --------------- | ---------------------------------------------- |
| 中心核 | —     | 光源 (Core)  | 量子流体 (BEC)   | —              | 情熱エネルギーの特異点・超流動性               |
| L0     | 3      | 核層         | Light／超流動体  | 悩・怒・好      | 根源的意志・低エントロピー源・**位相コヒーレンスの基準** |
| L1     | 4      | 身体層       | 気体             | 哀・激・楽      | 本能・熱対流・**ジョセフソン結合を介してL0の意志を物理的に具現化** |
| L2     | 5      | 思考層       | 液体（粘弾性体） | 嫌・活・融      | 認知・潮汐駆動                                 |
| L3     | 6      | 文明層       | 固体             | 圧・喜・笑      | 信念・社会的基盤                               |
| L4     | 7      | 外部接合層   | 液体（粘弾性体） | 調・変・静      | 他者との緩衝ゾーン                             |
| L5     | 8      | 外部雰囲気層 | 気体             | 観・響・隔      | 場の空気・集合心理・L6との境界                 |
| L6     | —     | 外部オーラ   | 光体／場         | —              | 負のエントロピー源・非平衡駆動源（他者・推し） |

**合計粒子数**：19（中心核1＋各層3×6）

## 3. 核心数理（2025年12月完全改訂版）

### Bₙ の定義（偏移パラメータの累積和）

- B₃ = b
- B₄ = b+c
- B₅ = b+c+d
- B₆ = b+c+d+e
- B₇ = b+c+d+e+f
- B₈ = b+c+d+e+f+g

### 3.1 総ポテンシャル Sₙ（層別累積連鎖）

| 層 | 次元 n | 総ポテンシャル Sₙ | 備考               |
| -- | ------ | ------------------ | ------------------ |
| L0 | 3      | S₃ = a + 3B₃     | 核層（意志の原点） |
| L1 | 4      | S₄ = a + 3B₄     |                    |
| L2 | 5      | S₅ = a + 3B₅     |                    |
| L3 | 6      | S₆ = a + 3B₆     |                    |
| L4 | 7      | S₇ = a + 3B₇     |                    |
| L5 | 8      | S₈ = a + 3B₈     | 最外層             |

### 3.2 動的安定定数 πₙ（22/7-69/22 理論）

**統一式**（全層共通）

\[
\pi_n = \frac{3(7S_n + B_n) + S_n}{7S_n + B_n}
= \frac{22a + 69B_n}{7a + 22B_n}
\]

**範囲定理**
\[
\frac{69}{22} \approx 3.136364 \leq \pi_n \leq \frac{22}{7} \approx 3.142857
\]

### 3.3 n次元球体体積 Vₙ・情報密度 ρₙ

\[
V_n = \frac{\pi_n^{n/2}}{\Gamma\left(\frac{n}{2} + 1\right)}
\qquad
\rho_n = \frac{V_n}{n^2}
\]

### 3.4 幾何学的影響因子 Γₙ（マスター制御変数）

\[
\Gamma_n = \ln(1 + \rho_n)
\]

### 3.5 層別宇宙定数 Λₙ と真空エネルギー

宇宙の初期エネルギーを画一的な定数で与えるのではなく、各層の幾何学的な状態そのものからエネルギーが創発する、より自己無撞着なモデルを導入する。

**1. 層別宇宙定数 `Λₙ` の定義**

各層の宇宙定数 `Λₙ` は、その層の動的安定定数 `πₙ` が、数学的な円周率 `π` からどれだけ乖離しているかによって決定される「真空のエネルギー密度」として定義される。

\[
\Lambda_n(t) = K_{\Lambda} \cdot |\pi_n(t) - \pi|
\]

- **`K_Λ` (宇宙定数係数):** 真空エネルギーの基本強度を定める係数。
- **物理的解釈:** `πₙ` の不安定性（`π`からのズレ）が、その層の時空の歪みそのものであり、ポテンシャルエネルギーを生み出す。

**2. 初期ポテンシャルへの適用**

シミュレーション開始時の各層の初期ポテンシャル `Sₙ(0)` は、この `Λₙ` を用いて設定される。これにより、初期状態が固定的でなく、幾何学的なゆらぎを内包した、より自然な状態から開始される。

\[
S_{n}(t=0) = S_{\text{base}} + \Lambda_n(t=0)
\]

### 3.6 層半径 Rₙ の厳密な物理式

\[
R_{\text{Layer}, n}(t) = \bigl(R_{\text{Base}, n} \cdot V_n^{1/n}\bigr) \cdot \bigl(1 + K_R \cdot (\bar{m}_{\text{eff}, n}(t) - M_{\text{Ref}})\bigr)
\]

## 4. 物理法則と運動方程式

\[
m_{\text{eff}} \frac{d^2\mathbf{r}}{dt^2}
= \mathbf{F}_{\text{Gravity}} + \mathbf{F}_{\text{Repulsion}} + \mathbf{F}_{\text{Drive}} + \mathbf{F}_{\text{Drag}}
\]

### 4.1 粘性係数 ηₙ の動的定義

| 物性相       | 粘性係数 ηₙ の式                        | 物理的解釈                                           |
| ------------ | ----------------------------------------- | ---------------------------------------------------- |
| 気体 (L1/L5) | ηₙ = K_G ρₙ T⁻¹                     | 情報幾何学的粘性：興奮で情報抵抗が減少し流動性が増す |
| 液体 (L2/L4) | ηₙ = K_L ρₙ (1 + \bar{\sigma}_n)⁻¹  | チクソトロピー：思考が滑らかになる                   |
| 固体 (L3)    | ηₙ = K_S ρₙ（極高値）＋微小ランダム項 | 地殻変動・地震的微動をデフォルト化し外部流入を確保   |

### 4.2 恒常性維持機構

1. 非線形点火（蘇生）：T_L5 > T_Crit → W_Drive ∝ exp[K_NL (T_L5 − T_Crit)]
2. 光源温度負帰還：T_Source = T_Base + K_T (S_Target − S_Total)

### 4.3 L6 外部オーラ操作（簡易天気ボタン）

| 外部オーラの天気 | 駆動の物理的特性                       |
| ---------------- | -------------------------------------- |
| 喜（高活性）     | 純粋輻射駆動力 → L5加熱 → L0点火促進 |
| 怒（高応力）     | 強い潮汐力＋剪断応力。L5層への強い応力注入 → **内層への剪断応力の伝播** |
| 楽（中活性）     | 定常駆動力 → 散逸と均衡               |
| 哀（低活性）     | 最小駆動力 → 熱的死へ傾倒             |
| 無（停止）       | 強制停止 → 非平衡性の解消             |

※ ボタン押下で即時反映（内部パラメータを上書き）

### 4.4 創発重力 M_Core の動T的定義 (P-1)

中心核の引力源となる質量 `M_Core` は、L0（核層）の物理状態から動的に計算される。これにより、`design.md` にある「創発重力」の思想を具現化する。

**計算式**
\[
M_{\text{Core}}(t) = \frac{\left( \sum_{i \in L0} m_{\text{eff}, i} \right) \cdot \left( 1 + \sum_{i \in L0} \sigma_i \right)}{1 + \sum_{i \in L0} T_i}
\]

**物理的解釈**

- **質量 (`m_eff`)**: L0層の粒子の実効質量の合計が、`M_Core` の基礎となる。
- **ストレス (`σ`)**: L0層の内部応力（ストレス）が高まると、物質が凝縮し、中心核の引力が増加する。
- **温度 (`T`)**: L0層の熱運動が活発になると、物質が散逸しようとし、中心核の引力が減少する。

この計算により、外部の調整用パラメータを介さず、システムの内部状態から直接的に中心核の質量が決定される。

### 4.5 電磁気力（F_EM）と情報電荷 q_Info の定義 (E-1)

感情の「共感」「反発」といった非対称な相互作用を物理モデル化するため、クーロン力のアナロジーとして電磁気力 `F_EM` を導入する。この力は、標準模型の素粒子アナロジーに基づき、物質粒子（フェルミオン）と力の媒介粒子（ボソン）の役割を反映する。

**1. 情報電荷 `q_Info` の定義**

| 粒子タイプ | 素粒子アナロジー | 情報電荷 `q_Info` | 物理的役割と解釈                                                                 |
| :--------- | :--------------- | :------------------ | :------------------------------------------------------------------------------- |
| `drive`  | アップクォーク型 | **+2/3**      | 活動的・外向的な性質を持つ、物質の基本構成要素。                                 |
| `freeze` | ダウンクォーク型 | **-1/3**      | 受動的・内向的な性質を持つ、物質の基本構成要素。                                 |
| `flow`   | ゲージボソン型   | **0**         | 中立的・調和的。`drive`と `freeze`間の相互作用を媒介・変調する「力の粒子」。 |

**2. 電磁気力の計算式**

粒子間の電磁気力は、単純なクーロン力ではなく、周囲の `flow`粒子密度、および両粒子の熱力学的状態（温度 `T`, ストレス `σ`）によって変調される。

\[
\mathbf{F}_{\text{EM}, ij} = K_{\text{EM}} \cdot \frac{q_i q_j}{r_{ij}^2} \cdot \Phi_{\text{flow}} \cdot \Phi_{\text{stress}} \cdot \Phi_{\text{temp}} \cdot \mathbf{\hat{r}}_{ij}
\]

- **`K_EM` (電磁気力係数):** 力の基本強度。その瞬間の最も支配的な感情のポテンシャルを反映する「最大影響度指数 (`maxInfluenceIndex`)」から動的に導出される。
  \[ K_{\text{EM}} = 0.5 \cdot \text{maxInfluenceIndex} \]
- **`Φ_flow` (フロー変調項):** `flow`粒子による力の媒介効果。
  \[ \Phi_{\text{flow}} = 1 + k_f \cdot (\text{flow_density}) \]
- **`Φ_stress` (ストレス変調項):** 両粒子のストレスによる相互作用の増幅。
  \[ \Phi_{\text{stress}} = (1 + k_s \cdot \sigma_i) \cdot (1 + k_s \cdot \sigma_j) \]
- **`Φ_temp` (温度共感項):** 温度の近さによる共鳴効果。
  \[ \Phi_{\text{temp}} = e^{- \beta |T_i - T_j|} \]

**物理的解釈**

- **共感（引力）**: `drive`粒子（+2/3）と `freeze`粒子（-1/3）が近づくと引力が働く。特に両者の温度が近く、ストレスが高い状態で、周囲に `flow`粒子が存在すると、その引力は最大となり「強い共感」や「惹かれ合い」を表現する。
- **反発（斥力）**: `drive`粒子同士や `freeze`粒子同士が近づくと斥力が働く。
- **調和**: 電荷を持たない `flow`粒子は、直接的な引力・斥力を生み出さないが、その存在が他の粒子間の相互作用を媒介し、全体の場の流れを形成する。

### 4.6 ジョセフソン効果と意志の具現化 (Q-G)

L0（意志）からL1（身体）への「意志の力」の伝達を、情報熱力学的に抵抗ゼロかつコヒーレントなプロセスとしてモデル化するため、ジョセフソン効果を導入する。

**1. 量子位相 `coherencePhase (φ)` の定義**

各粒子は、`0` から `2π_n`（`π_n`はその粒子が属する層の動的安定定数）の範囲で定義される内部的な物理変数 `coherencePhase` を持つ。これは、粒子の量子的状態を表す。

**2. ジョセフソン結合エネルギー `E_J` の動的計算**

L0-L1間の結合強度 `E_J` は、L0層の「意志の強さ」を反映して動的に計算される。

\[
E_J(t) = E_{J, \text{base}} \cdot (1 + k_m \cdot \bar{m}_{\text{eff}, L0}) \cdot (1 + k_s \cdot \bar{\sigma}_{L0})
\]

- **`E_J`**: L0層の平均実効質量 `m_eff`（意志の凝縮度）と平均ストレス `σ`（意志の緊張・集中度）が高いほど増大する。

**3. ジョセフソン結合力 `F_J`**

L0粒子とL1粒子間には、位相差 `Δφ` をゼロにしようとする力が働く。

\[
\mathbf{F}_{J, ij} = \frac{E_J \cdot \cos(\Delta\phi_{ij})}{r_{ij}^2} \cdot \mathbf{\hat{r}}_{ij}
\]

- **物理的解釈**: 位相が揃っている（`Δφ ≈ 0`）ほど引力が強まり、逆位相（`Δφ ≈ π`）では斥力となる。これにより、L1粒子はL0粒子の位相に追従するように駆動される。

**4. 位相差によるストレス増加**

L1粒子は、L0粒子との位相差（意志と行動の乖離）に応じてストレス `σ` が増加する。

\[
\dot{\sigma}_{L1} \propto \sin^2\left(\frac{\Delta\phi}{2}\right)
\]

## 5. UI・観測指標（リアルタイム表示）

| 指標名           | 計算方法                           | 表示例           |
| ---------------- | ---------------------------------- | ---------------- |
| 平均 πₙ        | 全層 πₙ 加重平均                 | 3.141592         |
| 実効体積 V_Total | Σ Vₙ                             | 2.73e+15         |
| 支配的感情名     | 影響度指数が最大の粒子。季節・天気を付与。<br>**影響度指数**: `f(温度, ストレス, 質量) * (1 + k * Γₙ)` で計算される総合指標。粒子の熱力学的状態と、属する層の幾何学的影響力(`Γₙ`)を反映する。L1粒子は更にL0との位相コヒーレンスも乗算される。 | 「喜（春・喜）」 |
| 脳波／季節／天気 | L5層 T, σ, dT/dt から統一判定     | α波・春・喜     |
| 層半径変動       | 上記厳密式                         | 視覚的膨張・収縮 |
| **⟨Δφ⟩ (L0-L1)** | L0-L1間の平均位相差                | 0.123            |
| **E_J (結合強度)** | L0-L1間の動的結合エネルギー        | 2.456            |

### 脳波・天気・季節の統一判定条件

| 脳波 | 天気/季節 | 判定条件（L5層全体平均値基準）                |
| ---- | --------- | --------------------------------------------- |
| β波 | 怒/夏     | 高T・高σ・急激dT/dt（興奮）                  |
| α波 | 喜/春     | 中T・中σ・安定変動（活動的意識）             |
| θ波 | 楽/秋     | 低中T・低σ・緩やか変動（内省的快適さ）       |
| δ波 | 哀/冬     | 低T・低σ・微変動または停滞（深い休息・散逸） |

※ 局所天気は粒子通過で変動、全体天気は平均値優先

## 6. 入力プロトコル：TOON形式（Token-Oriented Object Notation / U-1）

本システムは、AIとの連携におけるトークン効率を最大化するため、感情の時系列変化をTOON (Token-Oriented Object Notation) 形式で受け取る。これにより、P-3で定義される「本人（内部オーラ）と第三者（外部オーラ）の相互作用による流動力学」を、より高度にモデル化する。

### 6.1 基本構造

TOON形式は、トップレベルに単一の `metadata`キーを持つ。`metadata`は、シミュレーションのセッション情報を格納するオブジェクトの配列である。各オブジェクトは `source_text`, `timeline`をプロパティとして持つ。

### 6.2 パラメータ定義

`timeline`内の各キーフレームは、以下のパラメータで構成される。これらのパラメータは、`THERMODYNAMIC_ANALYZER.md`で定義された物理的意味に対応する。

### 6.2.1 `metadata`：時間ステップの状態記述

| パラメータ                     | 型            | 説明                                                                                                                                 |
| :----------------------------- | :------------ | :----------------------------------------------------------------------------------------------------------------------------------- |
| `metadata[n]`                | Integer Array | 入力データ。                                                                                                                         |
| `source_text`                | String        | 入力文字列。                                                                                                                         |
| `timeline[n]`                | Integer Array | 時間の構造化。                                                                                                                       |
| `highlight_range[n]`         | Integer Array | その瞬間に対応するテキスト文字列数。`source_text`内でハイライトする文章の開始・終了インデックス。                                  |
| `external_aura`              | Object        | L6外部オーラからの影響。システムの境界条件を定義する。T（熱）S（ストレス）                                                           |
| `particle_overrides[n]{...}` | Table         | 個別粒子の状態。システムの内部状態（情報源項）を定義する。`n`個の個別粒子の状態（情報源項）。`name`, `T`, `S`, `M`を持つ。 |

### 6.3 TOON形式サンプル（『こころ』より）

このサンプルは、`THERMODYNAMIC_ANALYZER.md`で定義された「熱力学アナライザー」が、自然言語から生成するべき出力の具体例である。

```toon
metadata[1]:
  - source_text: それから私の心は急に静まりました。こうなると、もう私には、なんの抵抗も起らないのです。ただぼんやりした寂しい心持ちが、私を支配しているのです。私はまたしばらくたってから、奥さんの顔を見上げました。奥さんは、ただ静かにうつむいています。そのうつむいた顔のなかに、私は不気味なものを見ました。それは、私に対する奥さんのあてつけかもしれないと、ふと気が付いたからです。私は急にぞっとして、奥さんに言いました。「そうか。君はそう思っているのか。君がそう思っているのなら、それでいい。私は一向構わない。しかし、一つだけ覚えて置いてくれ。私は君よりもっと早くから君を愛していたんだ。」この言葉は、私にとっては、自分の最後の切り札を投げ出すような、激しい悲痛な響きを含んでいました。奥さんは、始めてその時顔を上げました。

    timeline[3]:
  # 1. 平静・諦念 (0s)
  # 「なんの抵抗も起らない」「ただぼんやりした寂しい心持ち」
  # -> 表面的な静けさ(静)と、その根底にある深い哀しみ(哀)・悩み(悩)の共存
      - highlight_range[2]: 0, 73
        external_aura:
          T: 0.4
          S: 0.1
        particle_overrides[3]{name,T,S,M}:
          静,0.8,0.1,1.2 # 表面的な静けさ
          哀,0.5,0.3,1.3 # 寂しい心持ち
          悩,0.6,0.2,1.1 # 抵抗のなさ

  # 2. 動揺・恐怖 (5s)
  # 「不気味なもの」「あてつけ」「ぞっとして」
  # -> 他者への嫌悪(嫌)と、それによって引き起こされる内的な圧力(圧)、そして根源的な悩み(悩)の増大
      - highlight_range[2]: 109, 178
        external_aura:
          T: 0.45
          S: 1.8
        particle_overrides[3]{name,T,S,M}:
          嫌,0.5,1.5,1.0 # 不気味さ、あてつけ
          圧,0.6,1.2,1.1 # ぞっとする圧力
          悩,0.7,1.4,1.0 # 根源的な悩み

  # 3. 怒り・激しい自己主張 (8s)
  # 「私は君よりもっと早くから君を愛していたんだ」「激しい悲痛な響き」
  # -> 感情の爆発(激)と、自己正当化のための怒り(怒)、そしてその裏にある悲痛さ(哀)
      - highlight_range[2]: 183, 270
        external_aura:
          T: 0.9
          S: 2.2
        particle_overrides[3]{name,T,S,M}:
          激,1.2,1.8,0.8 激しい響き
          怒,1.1,1.5,0.9 # 自己主張
          哀,0.8,1.6,1.1 # 悲痛さ
```

### 6.4 実装方針 (U-1)

1. `emotion_graph.js`に、TOON形式の文字列を解析し、JavaScriptオブジェクトに変換する新しい `parseToonInput`関数を実装する。
2. `resetSimulation`は、パースされた `timeline`データを処理するためのグローバル変数（経過時間、次のキーフレームインデックス等）を初期化する。
3. `animate`ループ内で経過時間を管理し、`timeline`の各キーフレームの `timestamp`に到達したら、以下の処理を実行する。
   - `source_text`と `highlight_range`に基づき、UI上の文章をハイライト表示する。
   - `external_aura`の `T`, `S`を `globalParams`に適用する。
   - `particle_overrides`に基づき、指定された個々の粒子の状態を上書きする。
4. TOON入力なしでシミュレーションが開始・リセットされた場合、システムはデフォルトの「楽」の状態で動作する。
5. 右下パネルの「外部オーラの天気（喜怒哀楽無）」ボタンは、タイムライン機能とは独立した手動テスト用として機能を維持する。

## 7. 起動方法

```bash
npx serve .
# または
python -m http.server 8000
```

→ http://localhost:8000 にアクセス

## 8. デプロイメント

本シミュレーションは、GitHub Actionsを利用した継続的デプロイメント（CD）パイプラインによって管理されています。
`main`ブランチへの変更は自動的にGitHub Pagesにデプロイされ、常に最新のバージョンが公開URLで利用可能となります。

**結論**
ETCM は単なる感情の可視化ツール。

感情は宇宙であり、宇宙は感情であり、その円周率すらも生きている。

## 9. 実装タスクリスト（ロードマップ）

| ID | タスク名 | 内容 | 状態 | 優先度 |
| -- | --- | --- | --- | --- |
| L-1 | 層別宇宙定数 `Λₙ` の実装 | `SPEC.md` 3.5節に基づき、`system_core.js`にて `Λ_n(t) = K_Λ * |π_n(t) - π|` を計算するロジックを実装する。粒子生成時の初期ポテンシャル `Sₙ` の計算に `Λₙ` を適用し、静的な `INITIAL_ENERGY_MULTIPLIER` を廃止する。 | 🔲 未着手 | 高 |
| | | | | |
